language: cpp

compiler:
 - clang
 - gcc

env:
  matrix:
    - CONF=debug
    - CONF=release
  global:
    # prepare for 32/64 bit multi-arch support
    - BITS=64
    - secure: "CR3yKliFhwQLX+Zs1PCRcGej6jr4DIZsCqs9x6J2NN+U9Aow0gd/uiPBho/utgm+/TmSBji5n8FO/J3ORo34q4gC6EebTEaN4gCHNXVlIBJFw9x+Gs/lML5i8F2AoweFJY334OVaOf9qC8ZVJ8Z1nEwxj77fq3gcSLzRU3pIaS8="

before_install:
  - sudo add-apt-repository -y ppa:codegear/release
  - sudo apt-get update -qq
  - sudo apt-get install -y premake4 valgrind

install: true

before_script:
  - pushd build && premake4 'gmake' && popd

script:
  - make -C build/gmake -f test.make    config=${CONF}${BITS}
  - make -C build/gmake -f example.make config=${CONF}${BITS}
  - pushd bin
  -  ./unittest_${CONF}_x${BITS}_gmake
  - valgrind --leak-check=full --error-exitcode=1 ./unittest_${CONF}_x${BITS}_gmake
  - if [ "$CONF" = "release" ]; then ./perftest_${CONF}_x${BITS}_gmake; fi
  - popd
  - ./build/travis-doxygen.sh;
